<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± AppWrite</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@10.0.0"></script>
    <style>
        body {
            background: #000;
            color: white;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }
        
        #error-panel {
            position: fixed;
            bottom: 70px;
            left: 10px;
            right: 10px;
            background: rgba(239, 68, 68, 0.95);
            color: white;
            padding: 10px;
            border-radius: 10px;
            z-index: 9999;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #dc2626;
            text-align: right;
            direction: rtl;
        }
        
        .success {
            background: rgba(34, 197, 94, 0.95) !important;
            border: 2px solid #16a34a !important;
        }
        
        .container {
            margin-top: 50px;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
        }
        
        .test-result {
            margin: 20px auto;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 10px;
            max-width: 400px;
            text-align: right;
            direction: rtl;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ AppWrite</h1>
        <p>PROJECT ID: 696ea7200039a13fde62</p>
        <p>Database ID: 1891231976</p>
        
        <button onclick="testConnection()">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <button onclick="clearResults()">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        
        <div id="results"></div>
    </div>

    <div id="error-panel" style="display: none;"></div>

    <script>
        let client, account, databases;
        
        function showError(title, message) {
            const panel = document.getElementById('error-panel');
            panel.innerHTML = `<strong>âŒ ${title}:</strong> ${message}`;
            panel.className = '';
            panel.style.display = 'block';
            
            setTimeout(() => {
                panel.style.display = 'none';
            }, 10000);
        }
        
        function showSuccess(message) {
            const panel = document.getElementById('error-panel');
            panel.innerHTML = `<strong>âœ… ${message}</strong>`;
            panel.className = 'success';
            panel.style.display = 'block';
            
            setTimeout(() => {
                panel.style.display = 'none';
                panel.className = '';
            }, 3000);
        }
        
        function addResult(text, isSuccess = true) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'test-result';
            div.innerHTML = isSuccess ? `âœ… ${text}` : `âŒ ${text}`;
            div.style.color = isSuccess ? '#10b981' : '#ef4444';
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function testConnection() {
            clearResults();
            
            try {
                // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø©
                addResult('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© AppWrite...', true);
                if (typeof Client === 'undefined') {
                    throw new Error('Ù…ÙƒØªØ¨Ø© AppWrite Ù„Ù… ØªØ­Ù…Ù„');
                }
                
                // 2. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
                addResult('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§ØªØµØ§Ù„...', true);
                client = new Client()
                    .setEndpoint('https://fra.cloud.appwrite.io/v1')
                    .setProject('696ea7200039a13fde62');
                
                account = new Account(client);
                databases = new Databases(client);
                
                // 3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                addResult('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', true);
                await account.createAnonymousSession();
                addResult('âœ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­', true);
                showSuccess('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­');
                
                // 4. Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø±Ø§Ø¡Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                addResult('Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', true);
                const users = await databases.listDocuments('1891231976', 'users', [], 1);
                addResult(`âœ“ Ù‚Ø±Ø§Ø¡Ø© Ù†Ø§Ø¬Ø­Ø©: ${users.total} Ù…Ø³ØªØ®Ø¯Ù…`, true);
                
                // 5. Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…
                addResult('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ...', true);
                const newUser = await databases.createDocument(
                    '1891231976',
                    'users',
                    'unique()',
                    {
                        telegram_id: 'test_' + Date.now(),
                        username: 'test_user',
                        first_name: 'Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ',
                        balance: 0,
                        status: 'test',
                        created_at: new Date().toISOString()
                    }
                );
                addResult(`âœ“ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§Ø¬Ø­: ${newUser.$id}`, true);
                
                // 6. Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªØ®Ø¯Ù…
                addResult('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...', true);
                await databases.updateDocument(
                    '1891231976',
                    'users',
                    newUser.$id,
                    { last_active: new Date().toISOString() }
                );
                addResult('âœ“ ØªØ­Ø¯ÙŠØ« Ù†Ø§Ø¬Ø­', true);
                
                // 7. Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
                addResult('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ...', true);
                await databases.deleteDocument('1891231976', 'users', newUser.$id);
                addResult('âœ“ Ø­Ø°Ù Ù†Ø§Ø¬Ø­', true);
                
                addResult('ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!', true);
                showSuccess('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!');
                
            } catch (error) {
                addResult(`ÙØ´Ù„: ${error.message}`, false);
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', error.message);
                console.error('Test error:', error);
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        setTimeout(testConnection, 1000);
    </script>
</body>
</html>
